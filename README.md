# Whatsapp-Telergam Integration

Ссылка на документацию интеграции с другими платформами - https://github.com/green-api/greenapi-integration/blob/master/README.ru.md

О проекте
Этот репозиторий содержит код для интеграции мессенджера Telegram с Green API, позволяющий отправлять и получать сообщения через Telegram с использованием API от Green API.

Предварительные требования:
1. Аккаунт в Green API
2. Зарегистрированный Telegram бот 
3. Node.js версии 14 или выше
4. npm или yarn
5. Dнешний адрес webhook-а а так же возможность этого webhook-а реагировать на новые запросы 

Настройка:
Настройка Green API
	Зарегистрируйтесь на Green API
	Получите idInstance и apiTokenInstance в личном кабинете
	Добавьте эти значения в .env файл

Настройка Telegram бота
	Создайте нового бота через @BotFather
	Получите токен бота
	Добавьте токен в .env файл
	Включите получение сообщений в настройках бота (команда /setprivacy в @BotFather)

1) Скопируйте репозиторий коммандой git clone
2) Установить зависимости Green API следующей командой npm install @green-api/greenapi-integration
3) установить оставшиеся зависимости коммндой npm install
4) создать файл .env и заполнить его согласно шаблону 
      ```
      # Green API (WhatsApp)
      GREENAPI_INSTANCE_ID=
      GREENAPI_API_TOKEN=
      GREENAPI_PHONE_NUMBER=
      
      # Telegram Bot (для работы с группой)
      TELEGRAM_BOT_TOKEN=
      TELEGRAM_GROUP_CHAT_ID=
      
      # Webhook & Server
      APP_URL=
      PORT=
      ```
5) Запустить скрипт командой npm run dev

Cтруктура проекта:

      ├── src/
      │   ├── core/
      │   │   ├── adapter.ts
      │   │   ├── router.ts
      │   │   ├── storage.ts
      │   │   └── transformer.ts
      │   ├── main.ts
      │   └── types/
      │       └── types.ts
      ├──.env
      ├── tsconfig.json
      ├── package.json

Использование

После запуска бот будет:
      1. Принимать входящие сообщения из Telegram и пересылать их через Green API
      2. Принимать входящие уведомления от Green API и отправлять их в Telegram

Основыне файлы их описание:

package.json:
Файл конфигурации npm, содержащий:
      1. Список зависимостей (express, axios, node-telegram-bot-api, dotenv)
      2. Скрипты для запуска приложения
      3. Информацию о версии проекта
      
.env:
Файл для работы с переменными окружения

Adapter.ts:
Основа вашей интеграции. Управляет сообщениями и инстансами, а также логикой взаимодействия с платформой.

Router.ts:
Файл определяет маршруты Express для обработки вебхуков от Telegram и WhatsApp

Storage.ts:
Интерфейс для операций с хранением данных.

Transformer.ts:
Преобразовывает форматы сообщений между GREEN-API и вашей 

Main.ts:
Основная точка входа программы 

Types.ts:
Этот файл описывает интерфейсы TypeScript для структуры входящего вебхука от Telegram и исходящего сообщения, отправляемого в Telegram.

Возможные проблемы и решения
1. Сообщения не доходят:
      1. Проверьте, правильно ли указаны учетные данные в .env
      2. Убедитесь, что экземпляр Green API активен
      3. Проверьте настройки приватности Telegram бота
2. Ошибки подключения:
      1. Убедитесь, что ваш сервер имеет доступ к интернету
      2. Проверьте, не блокирует ли firewall исходящие подключения
3. Ошибки формата сообщений:
      1. Убедитесь, что номер телефона указан в международном формате без "+"
      2. Сообщение должно быть отделено от номера пробелом
